<html>
    <head>
        <TITLE>Covid19</TITLE>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    </head>
    <body>
        <canvas id="cases"></canvas>
    </body>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160266365-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-160266365-1');
    </script>
</html>
<script>

dataUrl = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv"

d3.csv(dataUrl).then(makeChart);

function makeChart(rawData)
{
    let countriesOfInterest = ["Estonia", "Latvia", "Lithuania"]; // can hardcode
    let countriesFilteredOut = ["Mainland China", "US"]; // todo: handle (summarize?)
    let minAmountOfCases = 100;

    let data = rawData.filter(function(x) {
        if (countriesFilteredOut.includes(x["Country/Region"])) return false;
        if (countriesOfInterest.includes(x["Country/Region"])) return true;
        return getMaxAmount(x) >= minAmountOfCases;
    });

    var labels = data.map(function(d) {return d["Country/Region"]});
    var volume = data.map(function(d) {return d["3/10/20"]});

    var chart = new Chart('cases', {
        type: 'horizontalBar',
        data: {
            labels: labels,
            datasets: [
                {
                    data: volume
                }
            ]
        }
    });
}

function getMaxAmount(countryRecord)
{
    let nonDateFields = ["Province/State","Country/Region","Lat","Long"];
    let values = [];
    for (var key in countryRecord) {
        if(nonDateFields.includes(key)) continue;
        console.log(countryRecord[key]);
        values.push(countryRecord[key]);
    }
    return Math.max(...values);
}

</script>