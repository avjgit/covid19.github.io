<html>

<head>
    <TITLE>Covid19</TITLE>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.5.4/randomColor.min.js"></script>
    <style>
        .question {
            font-weight: bold;
        }

        .toogleHandle {
            border-bottom: 2px dashed #000;
        }

        img {
            width: 50%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <meta name="google-site-verification" content="fx4I-sOTo-wiQwNT5vd1cRcSmYAfNrVdJSY3g1woL34" />
</head>

<body>
    <div id="disclaimer">
        Exact numbers in
        <a
            href="https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv">
            datasource for infection cases</a> might be updated with delay (day or two), follow your local media for
        latest
        information.<br />
        Bear in mind, that different countries have different approach to testing and statistics.<br />
    </div>

    <canvas id="timelineCasesLatviaItaly"></canvas>

    <div id="otherCanvas">
        <h2>
            <span onclick="toogleHide('otherCharts');" class="toogleHandle">Show other charts</span>
        </h2>

        <div id="otherCharts" style="display: none;">
            <canvas id="timelineCasesPerCapita"></canvas>
            <canvas id="timelineCases"></canvas>
            <canvas id="barChartCases"></canvas>
        </div>
    </div>

    <h2>
        <span onclick="toogleHide('Q&A');" class="toogleHandle">
            This is serious desease, we should fight it. Show Q & A
        </span>
    </h2>

    <div id="Q&A" style="display: none;">
        <p>
            <div class="question">- This is just a flu</div>
            This is more serious. Searchable quotes from <a
                href="https://www.who.int/docs/default-source/coronaviruse/situation-reports/20200306-sitrep-46-covid-19.pdf?sfvrsn=96b04adf_4">
                World Health Organization</a>:
            <ul>
                <li>"The reproductive number – the number of secondary infections generated from one infected individual
                    –
                    is understood to be between 2 and 2.5 for COVID-19 virus, higher than for influenza" </li>
                <li> "fractions of severe and critical infection would be higher than what is observed for influenza"
                </li>
                <li>"crude mortality ratio (the number of reported deaths divided by the reported cases) is between
                    3-4%.
                    For seasonal influenza, mortality is usually well below 0.1%." - so tens times more</li>
            </ul>
            3-4% are average numbers across all groups, but for older people they are much higher - 8% for 70 years old,
            almost 15% for 80 and older
        </p>
        <p>
            <div class="question">- Most will get through with just mild simptoms</div>
            Younger healthier adults - maybe, but our parents and colleagues with heart problems want to live too.
        </p>
        <p>
            <div class="question">- For serious cases there will be doctors</div>
            Unless there are too many cases and not enough Intensive Care Units for infected.
            <a
                href="https://www.who.int/docs/default-source/coronaviruse/situation-reports/20200306-sitrep-46-covid-19.pdf?sfvrsn=96b04adf_4">
                WHO</a>: 80% of infections are mild or asymptomatic, 15% are severe infection,
            requiring oxygen and 5% are critical infections, requiring ventilation.
            High numbers of infected makes those 20% of serious case too high for hospitals to handle.
        </p>
        <p>
            <div class="question">- But we have not so many cases in our country</div>
            We need to do all possible to keep so. It starts with small numbers,
            but with reproductive number 2 means it can grow high, quickly.
            How quick is doubling (exponential) growth?
            Imagine a chess board. Place a grain of wheat on first square,
            two grains on second, four - on third, and so on, doubling each time.
            So, roughly, to cover all chess board, how much bags of wheat wil you need?
            <span onclick="toogleHide('answer');" class="toogleHandle"> Show answer </span>
            <span id="answer" style="display: none;">
                <a href="https://en.wikipedia.org/wiki/Wheat_and_chessboard_problem"> 1,199,000,000,000 metric tons</a>.
                This is about 1645 times the global production of wheat (~780 million tonnes in 2019).
                Not trying to <a href="https://xkcd.com/605/">extrapolate</a>, not everyone will get ill,
                but unless precaution meathers taken, epidemy grows big; it is big - pandemy - already now
            </span>
        </p>
        <p>
            <div class="question">- Everyone who supposed to get ill, will; cannot contain virus already anyway</div>
            We need to do everything we can to stop spreading, or, at least, slow down.
            Slowing down is realistic and very important.
            Health systems cannot handle sudden peak of cases, but will better serve if those cases will be spread over
            longer time. There are <a
                href="https://www.reddit.com/r/Coronavirus/comments/fh06s2/what_flattening_the_curve_actually_looks_like/">
                historical evidence</a> from Spanish Flu, it helps not just spread in time, but minimize total counts.
        </p>
        <p>
            <div class="question">- Ok, so what can we do?</div>
            <div>Excellent resource is <a href="https://www.flattenthecurve.com/">flattenthecurve.com</a>, please read
                it.
            </div>
            Follow instructions from local health authorities and <a href="http://who.int/covid-19"> recommendations</a>
            from World Health Organization's issued or just <a
                href="https://staythefuckhome.com/">staythefuckhome.com</a>.
        </p>
        <img src="https://i.imgur.com/86On2AZ.gif">

    </div>

    <div id="footer">

        There are more dashboards with maps, total number of cases and other metrics:
        by <a
            href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">Johns
            Hopkins university</a>,
        with <a href="https://coronavirus.arik.io/">advanced filters</a> and
        <a href="https://covid19info.live/en/">more</a>.

        <div id="errorFeedback">There should be charts visible. If you don't see them, please <a
                href="https://github.com/avjgit/covid19.github.io/issues/new">open an issue</a>.</div>
        <div id="errorFeedback">Source is <a href="https://github.com/avjgit/covid19.github.io">open</a>, feel free to
            clone
            and modify. Pull requests and issues are welcome.</div>

        <a href="https://github.com/samayo/country-json/blob/master/src/country-by-population.json">Datasource for
            population</a>.
    </div>

</body>
<script>

    dataUrl = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"
    populationUrl = "https://raw.githubusercontent.com/samayo/country-json/master/src/country-by-population.json";

    d3.csv(dataUrl)
        .then(downloadedCases =>
            d3.json(populationUrl)
                .then(downloadPopulation =>
                    makeChart(downloadedCases, downloadPopulation)));

    function makeChart(rawData, populationRaw) {

        let countriesOfInterest = ["Estonia", "Latvia", "Lithuania", "Germany", "Italy"]; // can hardcode
        let countriesFilteredOut = ["China", "US", "Others", "Cruise Ship"]; // todo: handle (summarize?)
        let minAmountOfCases = 1000;
        let populationDivisor = 1000000;

        let populations = populationRaw.map(function (x) {
            return {
                country: mapCountry(x.country),
                population: x.population / populationDivisor
            }
        });

        let datesLabels = dateLabels(rawData[0]);

        let data = rawData.filter(function (x) {
            if (countriesFilteredOut.includes(x["Country/Region"])) return false;
            if (countriesOfInterest.includes(x["Country/Region"])) return true;
            return getMaxAmount(x, datesLabels) >= minAmountOfCases;
        });

        let [year, month, day] = yesterdaysDate();
        let dateUSA = usaDate(year, month, day);
        let dateISO = isoDate(year, month, day);
        let labels = data.map(x => x["Country/Region"]);
        let volume = data.map(x => x[dateUSA]);

        let chartDatsets = data.map(function (x) {
            return {
                label: x["Country/Region"],
                data: nonZeroValues(valuesPerDates(x, datesLabels)),
                fill: false,
                borderColor: randomColor()
            };
        });

        let chartDatsetsLatviaItaly = chartDatsets.map(function (x) {
            return {
                label: x.label,
                data: x.data,
                fill: false,
                borderColor: x.borderColor,
                hidden: !countriesOfInterest.includes(x.label)
            };
        })
            .sort((a, b) => a.label.localeCompare(b.label));

        // update with latest data
        // chartDatsetsLatviaItaly.

        // let chartPerCapitaDatasets = chartDatsets.map(function (x) {
        //     let countryPopulation = populations.filter(p => p.country == x.label)[0].population;
        //     return {
        //         label: x.label,
        //         data: x.data.map(z => parseInt(z) / countryPopulation),
        //         fill: x.fill,
        //         borderColor: x.borderColor
        //     };
        // });

        let maxDays = Math.max(...chartDatsets.map(x => x.data.length));
        let daysLabels = generateLabels(maxDays);

        // new Chart('timelineCasesPerCapita', {
        //     type: 'line',
        //     data: {
        //         labels: daysLabels,
        //         datasets: chartPerCapitaDatasets
        //     },
        //     options: {
        //         title: {
        //             display: true,
        //             text: 'Total count since first infected, per ' + populationDivisor + ' people',
        //         }
        //     }
        // });

        new Chart('timelineCasesLatviaItaly', {
            type: 'line',
            data: {
                labels: daysLabels,
                datasets: chartDatsetsLatviaItaly
            },
            options: {
                legend: {
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Total count since first infected. Logarithmic scale - shows 10, 100, 1000 etc. Can switch country on/off in legend',
                },
                scales: {
                    yAxes: [{
                        type: 'logarithmic',
                        ticks: {
                            min: 1, //minimum tick
                            max: 100000, //maximum tick
                            callback: function (value, index, values) {
                                return Number(value.toString());//pass tick values as a string into Number function
                            }
                        }
                    }]
                }
            }
        });

        new Chart('timelineCases', {
            type: 'line',
            data: {
                labels: daysLabels,
                datasets: chartDatsets
            },
            options: {
                title: {
                    display: true,
                    text: 'Total count since first infected',
                }
            }
        });

        new Chart('barChartCases', {
            type: 'horizontalBar',
            data: {
                labels: labels,
                datasets: [
                    {
                        data: volume
                    }
                ]
            },
            options: {
                legend: {
                    display: false,
                },
                title: {
                    display: true,
                    text: 'Infected on ' + dateISO,
                }
            }
        });
    }

    function dateLabels(jsonObj) {
        let nonDateProperties = ["Province/State", "Country/Region", "Lat", "Long"];
        let dateProperties = [];
        for (var property in jsonObj) {
            if (nonDateProperties.includes(property)) continue;
            dateProperties.push(property);
        }
        return dateProperties;
    }

    let nonZeroValues = (values) => values.filter(x => x !== "0");
    let valuesPerDates = (countryRecord, datesLabels) => datesLabels.map(x => countryRecord[x]);
    let getMaxAmount = (countryRecord, datesLabels) => Math.max(...valuesPerDates(countryRecord, datesLabels));
    let usaDate = (year, month, day) => month + '/' + day + '/' + year;
    let isoDate = (year, month, day) => '20' + year + '/' + month + '/' + day;

    function yesterdaysDate() {
        var date = new Date();
        date.setDate(date.getDate() - 1);
        var year = date.getFullYear().toString().substr(-2);
        var month = date.getMonth() + 1; //js months are zero-based
        var day = date.getDate();
        return [year, month, day]
    }

    function generateLabels(count) {
        labels = [];
        for (let i = 1; i <= count; i++) labels.push("Day " + i);
        return labels;
    }

    function mapCountry(country) {
        if (country === "South Korea") return "Korea, South";
        if (country === "Hong Kong") return "Hong Kong SAR";
        return country;
    }

    function toogleHide(elementId) {
        var el = document.getElementById(elementId);
        el.style.display = el.style.display === "block" ? "none" : "block";
    }
</script>

<!-- this is chatbot; not critically necessary-->
<script type="text/javascript" async>
    (function (d, h) {
        s = d.createElement('script');
        s.type = 'text/javascript';
        s.src = h;
        s.setAttribute('data-config', "https://widget.alphablues.com/config/GvAOtVG0Wg");
        x = d.getElementsByTagName('script')[0];
        x.parentNode.insertBefore(s, x);
    })(document, "https://widget.alphablues.com/widget/latest/bundle.prod.js");
</script>

<!-- this is Google analytics; not critically necessary-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160266365-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-160266365-1');
</script>

</html>