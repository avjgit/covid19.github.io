<html>

<head>
    <TITLE>Covid19</TITLE>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.5.4/randomColor.min.js"></script>
    <style>
        .question {
            font-weight: bold;
        }

        img {
            width: 50%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <meta name="google-site-verification" content="fx4I-sOTo-wiQwNT5vd1cRcSmYAfNrVdJSY3g1woL34" />
</head>

<body>
    <p>
        <div class="question">- This is just a flu</div>
        This is more serious. Searchable quotes from <a
            href="https://www.who.int/docs/default-source/coronaviruse/situation-reports/20200306-sitrep-46-covid-19.pdf?sfvrsn=96b04adf_4">
            World Health Organization</a>:
        <ul>
            <li>"The reproductive number – the number of secondary infections generated from one infected individual –
                is understood to be between 2 and 2.5 for COVID-19 virus, higher than for influenza" </li>
            <li> "fractions of severe and critical infection would be higher than what is observed for influenza" </li>
            <li>"crude mortality ratio (the number of reported deaths divided by the reported cases) is between 3-4%.
                For seasonal influenza, mortality is usually well below 0.1%." - so tens times more</li>
        </ul>
        3-4% are average numbers across all groups, but for older people they are much higher - 8% for 70 years old,
        almost 15% for 80 and older
    </p>
    <p>
        <div class="question">- Most will get through with just mild simptoms</div>
        Younger healthier adults - maybe, but our parents and colleagues with heart problems want to live too.
    </p>
    <p>
        <div class="question">- For serious cases there will be doctors</div>
        Unless there are too many cases and not enough Intensive Care Units for infected.
        <a
            href="https://www.who.int/docs/default-source/coronaviruse/situation-reports/20200306-sitrep-46-covid-19.pdf?sfvrsn=96b04adf_4">
            WHO</a>: 80% of infections are mild or asymptomatic, 15% are severe infection,
        requiring oxygen and 5% are critical infections, requiring ventilation.
        High numbers of infected makes those 20% of serious case too high for hospitals to handle.
    </p>
    <p>
        <div class="question">- But we have not so many cases in our country</div>
        We need to do all possible to keep so. It starts with small numbers,
        but with reproductive number 2 means it can grow high, quickly.
        How quick is doubling (exponential) growth?
        Imagine a chess board. Place a grain of wheat on first square,
        two grains on second, four - on third, and so on, doubling each time.
        So, roughly, to cover all chess board, how much bags of wheat wil you need?
        <span onclick="showAnswer();" style="border-bottom: 2px dashed #000;"> Show answer </span>
        <span id="answer" style="display: none;">
            <a href="https://en.wikipedia.org/wiki/Wheat_and_chessboard_problem"> 1,199,000,000,000 metric tons</a>.
            This is about 1645 times the global production of wheat (~780 million tonnes in 2019).
            Not trying to <a href="https://xkcd.com/605/">extrapolate</a>, not everyone will get ill,
            but unless precaution meathers taken, epidemy grows big; it is big - pandemy - already now
        </span>
    </p>
    <p>
        <div class="question">- Everyone who supposed to get ill, will; cannot contain virus already anyway</div>
        We need to do everything we can to stop spreading, or, at least, slow down.
        Slowing down is realistic and very important.
        Health systems cannot handle sudden peak of cases, but will better serve if those cases will be spread over
        longer time. There are <a
            href="https://www.reddit.com/r/Coronavirus/comments/fh06s2/what_flattening_the_curve_actually_looks_like/">
            historical evidence</a> from Spanish Flu, it helps not just spread in time, but minimize total counts.
    </p>
    <p>
        <div class="question">- Ok, so what can we do?</div>
        <div>Excellent resource is <a href="https://www.flattenthecurve.com/">flattenthecurve.com</a>, please read it.
        </div>
        Follow instructions from local health authorities and <a href="http://who.int/covid-19"> recommendations</a>
        from World Health Organization's issued or just <a href="https://staythefuckhome.com/">staythefuckhome.com</a>.
    </p>
    <img src="https://i.imgur.com/86On2AZ.gif">
    <canvas id="timelineCasesLatviaItaly"></canvas>
    <canvas id="timelineCasesPerCapita"></canvas>
    <canvas id="timelineCases"></canvas>
    <canvas id="barChartCases"></canvas>

    There are more dashboards with maps, total number of cases and other metrics:
    by <a href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">Johns Hopkins university</a>,
    with <a href="https://coronavirus.arik.io/">advanced filters</a> and 
    <a href="https://covid19info.live/en/">more</a>.

    <div id="errorFeedback">There should be charts visible. If you don't see them, please <a
            href="https://github.com/avjgit/covid19.github.io/issues/new">open an issue</a>.</div>
    <div id="errorFeedback">Source is <a href="https://github.com/avjgit/covid19.github.io">open</a>, feel free to clone
        and modify. Pull requests and issues are welcome.</div>

    Datasources: <a
        href="https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv">
        infection cases</a>,
    <a href="https://github.com/samayo/country-json/blob/master/src/country-by-population.json">population</a>.
</body>
<script>

    dataUrl = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv"
    populationUrl = "https://raw.githubusercontent.com/samayo/country-json/master/src/country-by-population.json";

    d3.csv(dataUrl)
        .then(downloadedCases =>
            d3.json(populationUrl)
                .then(downloadPopulation =>
                    makeChart(downloadedCases, downloadPopulation)));

    function makeChart(rawData, populationRaw) {

        let countriesOfInterest = ["Estonia", "Latvia", "Lithuania"]; // can hardcode
        let countriesFilteredOut = ["China", "US", "Others", "Cruise Ship"]; // todo: handle (summarize?)
        let minAmountOfCases = 100;
        let populationDivisor = 1000000;

        let populations = populationRaw.map(function (x) {
            return {
                country: mapCountry(x.country),
                population: x.population / populationDivisor
            }
        });

        let datesLabels = dateLabels(rawData[0]);

        let data = rawData.filter(function (x) {
            if (countriesFilteredOut.includes(x["Country/Region"])) return false;
            if (countriesOfInterest.includes(x["Country/Region"])) return true;
            return getMaxAmount(x, datesLabels) >= minAmountOfCases;
        });

        let [year, month, day] = yesterdaysDate();
        let dateUSA = usaDate(year, month, day);
        let dateISO = isoDate(year, month, day);
        var labels = data.map(x => x["Country/Region"]);
        var volume = data.map(x => x[dateUSA]);

        var chartDatsets = data.map(function (x) {
            return {
                label: x["Country/Region"],
                data: nonZeroValues(valuesPerDates(x, datesLabels)),
                fill: false,
                borderColor: randomColor()
            };
        });

        let chartDatsetsLatviaItaly = chartDatsets.map(function (x) {
            return {
                label: x.label,
                data: x.data,
                fill: false,
                borderColor: x.borderColor,
                hidden: x.label !== "Italy" && x.label !== "Latvia"
            };
        });

        var chartPerCapitaDatasets = chartDatsets.map(function (x) {
            let countryPopulation = populations.filter(p => p.country == x.label)[0].population;
            return {
                label: x.label,
                data: x.data.map(z => parseInt(z) / countryPopulation),
                fill: x.fill,
                borderColor: x.borderColor
            };
        });

        var maxDays = Math.max(...chartDatsets.map(x => x.data.length));
        var daysLabels = generateLabels(maxDays);

        new Chart('timelineCasesPerCapita', {
            type: 'line',
            data: {
                labels: daysLabels,
                datasets: chartPerCapitaDatasets
            },
            options: {
                title: {
                    display: true,
                    text: 'Total count since first infected, per ' + populationDivisor + ' people',
                }
            }
        });

        new Chart('timelineCasesLatviaItaly', {
            type: 'line',
            data: {
                labels: daysLabels,
                datasets: chartDatsetsLatviaItaly
            },
            options: {
                title: {
                    display: true,
                    text: 'Total count since first infected Latvia, Italy',
                },
                scales: {
                    yAxes: [{
                        type: 'logarithmic',
                        ticks: {
                            min: 1, //minimum tick
                            max: 100000, //maximum tick
                            callback: function (value, index, values) {
                                return Number(value.toString());//pass tick values as a string into Number function
                            }
                        }
                    }]
                }
            }
        });

        new Chart('timelineCases', {
            type: 'line',
            data: {
                labels: daysLabels,
                datasets: chartDatsets
            },
            options: {
                title: {
                    display: true,
                    text: 'Total count since first infected',
                }
            }
        });

        new Chart('barChartCases', {
            type: 'horizontalBar',
            data: {
                labels: labels,
                datasets: [
                    {
                        data: volume
                    }
                ]
            },
            options: {
                legend: {
                    display: false,
                },
                title: {
                    display: true,
                    text: 'Infected on ' + dateISO,
                }
            }
        });
    }
    function dateLabels(jsonObj) {
        let nonDateProperties = ["Province/State", "Country/Region", "Lat", "Long"];
        let dateProperties = [];
        for (var property in jsonObj) {
            if (nonDateProperties.includes(property)) continue;
            dateProperties.push(property);
        }
        return dateProperties;
    }

    let nonZeroValues = (values) => values.filter(x => x !== "0");
    let valuesPerDates = (countryRecord, datesLabels) => datesLabels.map(x => countryRecord[x]);

    let getMaxAmount = (countryRecord, datesLabels) => Math.max(...valuesPerDates(countryRecord, datesLabels));

    function yesterdaysDate() {
        var date = new Date();
        date.setDate(date.getDate() - 1);
        var year = date.getFullYear().toString().substr(-2);
        var month = date.getMonth() + 1; //js months are zero-based
        var day = date.getDate();
        return [year, month, day]
    }

    let usaDate = (year, month, day) => month + '/' + day + '/' + year;
    let isoDate = (year, month, day) => '20' + year + '/' + month + '/' + day;

    function generateLabels(amount) {
        labels = [];
        for (let index = 1; index <= amount; index++) {
            labels.push("Day " + index);
        }
        return labels;
    }
    function mapCountry(country) {
        if (country === "South Korea") return "Korea, South";
        if (country === "Hong Kong") return "Hong Kong SAR";
        return country;
    }
    let showAnswer = () => document.getElementById("answer").style.display = "block";
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160266365-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-160266365-1');
</script>

</html>